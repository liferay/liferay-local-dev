// workaround since tilt assumes that there is at least one of these tasks available
task createClientExtensionConfig

gradle.projectsEvaluated {
  buildDockerImage.dependsOn = buildDockerImage.dependsOn.findAll { !it.path.startsWith(":client-extensions") }

  subprojects {
    if (path.startsWith(":client-extensions") && file("client-extension.yaml").exists()) {
      assembleClientExtension {
        from "/repo/k8s/tls/rootCA.pem"
      }

      if (hasProperty('buildScan')) {
        buildScan {
          termsOfServiceUrl = 'https://gradle.com/terms-of-service'
          termsOfServiceAgree = 'yes'
        }
      }
    }
  }
}